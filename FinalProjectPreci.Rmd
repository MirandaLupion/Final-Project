---
title: "Final Project"
author: "Donovan Doyle"
date: "October 17, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(readxl)

spreads <- read.csv("spreadspoke_scores.csv")
```



```{r, echo = FALSE}
spreads_prep <- spreads %>%
  filter(!is.na(schedule_week)) %>%
  mutate(week = recode_factor(schedule_week, "1" = 1, "2" = 2, "3" = 3, "4" = 4, "5" = 5, "6" = 6, "7" = 7, "8" = 8, "9" = 9, "10" = 10, "11" = 11, "12" = 12, "13" = 13, "14" = 14, "15" = 15, "16" = 16, "17" = 17, "18" = 18)) %>%
  filter(!is.na(schedule_week)) %>%
  filter(!is.na(over_under_line)) %>%
  mutate(over_under_line = parse_number(over_under_line)) %>%
  group_by(week, over_under_line) %>%
  summarize(avgline = sum(over_under_line) / 825) %>%
  glimpse()


(spreads_plot <- spreads_prep %>%
  ggplot(aes(x = week, y = avgline)) + geom_bar(stat = "identity")) + labs(title = "Average Over/Under Lines by Week", x = "Week", y = "O/U set")


spreads_match <- spreads %>%
  select(schedule_season, team_home, team_away, team_favorite_id, spread_favorite, score_home, score_away, schedule_playoff) %>%
  filter(!is.na(spread_favorite)) %>%
  filter(schedule_playoff == "FALSE") %>%
  filter(schedule_season != 2018) %>%
  filter(schedule_season != 1978) %>%
  mutate(team_home = recode(team_home, "Tampa Bay Buccaneers" = "TB", "Arizona Cardinals" = "ARI", "Atlanta Falcons" = "ATL", "Baltimore Colts" = "IND", "Baltimore Ravens" = "BAL", "Buffalo Bills" = "BUF", "Carolina Panthers" = "CAR", "Chicago Bears" = "CHI", "Cincinnati Bengals" = "CIN", "Cleveland Browns" = "CLE", "Dallas Cowboys" = "DAL", "Denver Broncos" = "DEN", "Detroit Lions" = "DET", "Green Bay Packers" = "GB", "Houston Oilers" = "TEN", "Houston Texans" = "HOU", "Indianapolis Colts" = "IND", "Jacksonville Jaguars" = "JAX", "Kansas City Chiefs" = "KC", "Los Angeles Chargers" = "LAC", "Los Angeles Raiders" = "OAK", "Los Angeles Rams" = "LAR", "Miami Dolphins" = "MIA", "Minnesota Vikings" = "MIN", "New England Patriots" = "NE", "New Orleans Saints" = "NO", "New York Giants" = "NYG", "New York Jets" = "NYJ", "Oakland Raiders" = "OAK", "Philadelphia Eagles" = "PHI", "Phoenix Cardinals" = "ARI", "Pittsburgh Steelers" = "PIT", "San Diego Chargers" = "LAC", "San Francisco 49ers" = "SF", "Seattle Seahawks" = "SEA", "St. Louis Cardinals" = "ARI", "St. Louis Rams" = "LAR", "Tennessee Oilers" = "TEN", "Tennessee Titans" = "TEN", "Washington Redskins" = "WAS", .default = NULL)) %>%
  mutate(team_away = recode(team_away, "Tampa Bay Buccaneers" = "TB", "Arizona Cardinals" = "ARI", "Atlanta Falcons" = "ATL", "Baltimore Colts" = "IND", "Baltimore Ravens" = "BAL", "Buffalo Bills" = "BUF", "Carolina Panthers" = "CAR", "Chicago Bears" = "CHI", "Cincinnati Bengals" = "CIN", "Cleveland Browns" = "CLE", "Dallas Cowboys" = "DAL", "Denver Broncos" = "DEN", "Detroit Lions" = "DET", "Green Bay Packers" = "GB", "Houston Oilers" = "TEN", "Houston Texans" = "HOU", "Indianapolis Colts" = "IND", "Jacksonville Jaguars" = "JAX", "Kansas City Chiefs" = "KC", "Los Angeles Chargers" = "LAC", "Los Angeles Raiders" = "OAK", "Los Angeles Rams" = "LAR", "Miami Dolphins" = "MIA", "Minnesota Vikings" = "MIN", "New England Patriots" = "NE", "New Orleans Saints" = "NO", "New York Giants" = "NYG", "New York Jets" = "NYJ", "Oakland Raiders" = "OAK", "Philadelphia Eagles" = "PHI", "Phoenix Cardinals" = "ARI", "Pittsburgh Steelers" = "PIT", "San Diego Chargers" = "LAC", "San Francisco 49ers" = "SF", "Seattle Seahawks" = "SEA", "St. Louis Cardinals" = "ARI", "St. Louis Rams" = "LAR", "Tennessee Oilers" = "TEN", "Tennessee Titans" = "TEN", "Washington Redskins" = "WAS", .default = NULL)) %>%
  mutate(team_home = parse_character(team_home)) %>%
  mutate(team_away = parse_character(team_away)) %>%
  mutate(team_favorite_id = parse_character(team_favorite_id))
  
spreads_home_favorites <- spreads_match %>%
  filter(team_home == team_favorite_id) %>%
  rename(year = schedule_season, fav_team = team_home, under_team = team_away, home_team = team_favorite_id, spread = spread_favorite, fav_score = score_home, under_score = score_away, playoff = schedule_playoff) %>%
  mutate(home_fav = TRUE) %>%
  select(-home_team)

spreads_away_favorites <- spreads_match %>%
  filter(team_away == team_favorite_id) %>%
  rename(year = schedule_season, fav_team = team_away, under_team = team_home, away_team = team_favorite_id, spread = spread_favorite, fav_score = score_away, under_score = score_home, playoff = schedule_playoff) %>%
  mutate(home_fav = FALSE) %>%
  select(-away_team)

spreads_comb_under <- left_join(spreads_home_favorites, spreads_away_favorites) %>%
  mutate(diff = under_score - fav_score) %>%
  filter(diff > spread) %>%
  mutate(fav_cover = FALSE) %>%
  mutate(spread_win = under_team)
  
spreads_comb_fav <- left_join(spreads_home_favorites, spreads_away_favorites) %>%
  mutate(diff = under_score - fav_score) %>%
  filter(diff < spread) %>%
  mutate(fav_cover = TRUE) %>%
  mutate(spread_win = fav_team)

spreads_tidy <- left_join(spreads_comb_fav, spreads_comb_under)
```

```{r plots, echo = FALSE}
```

